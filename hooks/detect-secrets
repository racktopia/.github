#!/bin/bash
# Pre-commit hook: detect-secrets
# Check for accidentally committed secrets in Ansible files

set -e

exit_code=0

echo "üîç Checking for potential secrets..."

# Check for common secret patterns, excluding vaulted content and comments
for file in "$@"; do
    if [ -f "$file" ]; then
        if grep -i "password\|secret\|token\|api_key" "$file" | grep -v "ANSIBLE_VAULT" | grep -v "#" | grep -v "ansible_vault" >/dev/null 2>&1; then
            echo "‚ö†Ô∏è  Warning: Found potential secrets in $file:"
            grep -in "password\|secret\|token\|api_key" "$file" | grep -v "ANSIBLE_VAULT" | grep -v "#" | grep -v "ansible_vault" || true
            echo "   Consider using Ansible Vault for sensitive data."
            echo "   (This is a warning, not a failure)"
        fi
    fi
done

echo "‚úÖ Secret detection complete"
exit $exit_code