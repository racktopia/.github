#!/bin/bash
# Pre-commit hook: ansible-syntax-check
# Validates Ansible playbook syntax

set -e

# Check if ansible-playbook is available
if ! command -v ansible-playbook >/dev/null 2>&1; then
    echo "‚ùå ansible-playbook not found but required for Ansible syntax checking"
    echo ""
    echo "To fix this, install Ansible:"
    echo "  macOS:  brew install ansible"
    echo "  Other:  pip install ansible"
    exit 1
fi

exit_code=0

echo "üé≠ Checking Ansible playbook syntax..."

for playbook in "$@"; do
    if [ -f "$playbook" ]; then
        echo "  Checking: $playbook"
        if ansible-playbook --syntax-check "$playbook" >/dev/null 2>&1; then
            echo "  ‚úÖ $playbook syntax valid"
        else
            echo "  ‚ùå $playbook syntax invalid"
            ansible-playbook --syntax-check "$playbook"
            exit_code=1
        fi
    fi
done

if [ $exit_code -eq 0 ]; then
    echo "‚úÖ All playbook syntax checks passed"
else
    echo "‚ùå Playbook syntax check failed"
fi

exit $exit_code